<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyste Crédit - GMES</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .header { background: #6f42c1; color: white; padding: 1rem 2rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin: 2rem 0; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { display: inline-block; padding: 0.5rem 1rem; background: #007bff; color: white; text-decoration: none; border-radius: 5px; margin: 0.5rem; }
        .btn-warning { background: #ffc107; color: black; }
        .pret-card { background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .score-badge { padding: 0.3rem 0.8rem; border-radius: 20px; color: white; font-weight: bold; }
        .score-excellent { background: #28a745; }
        .score-bon { background: #17a2b8; }
        .score-moyen { background: #ffc107; color: black; }
        .score-faible { background: #dc3545; }
    </style>
</head>
<body>
    <div class="header">
        <h1>📊 Analyste Crédit GMES</h1>
        <p>Connecté en tant que: {{ current_user.prenom }} {{ current_user.nom }}</p>
        <a href="{{ url_for('deconnexion') }}" style="color: white;">Déconnexion</a>
    </div>

    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <h3>📋 En Attente</h3>
                <p style="font-size: 2rem; font-weight: bold;">{{ prets_en_attente|length }}</p>
                <p>Demandes à analyser</p>
            </div>
            <div class="stat-card">
                <h3>✅ Traités</h3>
                <p style="font-size: 2rem; font-weight: bold;">{{ prets_traites }}</p>
                <p>Ce mois</p>
            </div>
            <div class="stat-card">
                <h3>📈 Taux Approbation</h3>
                <p style="font-size: 2rem; font-weight: bold;">{{ taux_approbation|default(0) }}%</p>
            </div>
            <div class="stat-card">
                <h3>⏱️ Délai Moyen</h3>
                <p style="font-size: 2rem; font-weight: bold;">{{ delai_moyen }}</p>
                <p>Heures</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
            <!-- Outils d'Analyse -->
            <div style="background: white; padding: 2rem; border-radius: 10px;">
                <h3>🔧 Outils d'Analyse</h3>
                <a href="{{ url_for('analyse_automatique') }}" class="btn">🤖 Analyse Automatique</a>
                <a href="{{ url_for('scoring_clients') }}" class="btn">📈 Scoring Clients</a>
                <a href="{{ url_for('rapports_risque') }}" class="btn">📊 Rapports Risque</a>
                <a href="{{ url_for('parametres_scoring') }}" class="btn">⚙️ Paramètres</a>
            </div>

            <!-- Métriques -->
            <div style="background: white; padding: 2rem; border-radius: 10px;">
                <h3>📐 Métriques du Jour</h3>
                <p><strong>Moyenne Score Crédit:</strong> {{ score_moyen|default('N/A') }}</p>
                <p><strong>Risque Moyen:</strong> {{ risque_moyen|default('N/A') }}</p>
                <p><strong>Défauts Prédits:</strong> {{ defauts_predits|default(0) }}</p>
            </div>
        </div>

        <!-- Demandes en Attente -->
        <div style="background: white; padding: 2rem; border-radius: 10px;">
            <h3>📋 Demandes en Attente d'Analyse</h3>
            {% for pret in prets_en_attente %}
            <div class="pret-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4>{{ pret.motif }} - {{ pret.montant }} €</h4>
                        <p>Client: {{ pret.client.prenom }} {{ pret.client.nom }} | Durée: {{ pret.duree_mois }} mois</p>
                    </div>
                    <div>
                        <span class="score-badge score-{{ pret.score_categorie|default('moyen') }}">
                            Score: {{ pret.score_credit|default(0) }}
                        </span>
                        <a href="{{ url_for('analyser_pret', pret_id=pret.id) }}" class="btn btn-warning">🔍 Analyser</a>
                    </div>
                </div>
            </div>
            {% else %}
            <p>Aucune demande en attente 🎉</p>
            {% endfor %}
        </div>
    </div>
</body>
</html>